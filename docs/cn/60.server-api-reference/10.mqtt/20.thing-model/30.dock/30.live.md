## 直播相关变量解释
| 变量名                     | 说明                                                         |
| -------------------------- | ------------------------------------------------------------ |
| `device_list`              | 表明飞机(或者其他设备)的列表，里面包含了camera层次。         |
| `available_video_number`   | 可用于直播的视频流总数。表明飞机或设备所拥有的所有可用于直播视频流的总数。 |
| `coexist_video_number_max` | 可同时进行直播的最大视频流总数。                             |
| `camera_list`              | 表明某一个飞机（或者设备）所拥有的相机列表，里面包含了video层次 |
| `camera_type`              | 相机的型号                                                   |
| `camera_id`                | 相机的id号，由相机的型号名称+相机在飞机上的位置编号组成。在1个飞机（或者设备）里面，该编号唯一。 |
| `video_list`               | 表明某一个相机所拥有的视频流列表。                           |
| `video_type`               | 表明视频流的类型，如H20T相机中，有wide、zoom、ir、normal几种类型。关于normal和其他的区别：normal表示该通道的视频流内容会发生变化，如APP在前端进行一次画面内容调整的时候，H20T的直播画面内容就会发生变化。wide、zoom、ir表明该通道就是固定传输指定内容的画面的。除非通道进行切换，不然该通道内的画面内容是固定的，不会被APP调整所影响。 |
| `video_index`              | 表明视频流的索引和编号，由视频流的类型和视频流在相机内部的编号所示。如wide-0，在一个相机域内，该编号唯一 |
| `video_id`                 | 用来唯一指定有一个视频流的ID编号，组成规则`#{uav_sn}/#{camera_id}/#{video_index}`例：`AFAFEFA34D/H20T-0/normal-1` |
| `video_quality`            | 直播的质量，特制直播参数的几个档位，如自动、流畅、高清、超清。其中，每一个档位，对应一些已经预设的bps、fps、resolution，保证可以视频流的体验。如果选择自动，则自动在流畅、高清、超清几个档位中调节。 |
| `video_param_mode`         | 用来查询或者设置直播相关信息时所用到的mode提示，目前仅有“default”和“advanced”两种，其中default表明设置video_quality，advanced表明详细设置视频的bps、fps、resolution（dpi）。 |
| `live_trendline`           | 表示直播带宽的使用状态(或者说直播性能趋势)。每一个直播通道有一个有normal、overuse、underuse三种状态。例如overuse，表示带宽使用过载了，从而判断网络发生拥塞。如果是underuse状态，表示带宽未能充分利用。取值范围还是[0,10]：0-4表示overuse，其中，数值越小，表示overuse程度越大；5表示normal状态；6~10表示underuse，其中，数值越大，表示有更多比例的带宽未能充分利用。 |
| `live_time`                | 直播时间，表明设备端开始直播之后所运行的时间                 |
| `url_type`                 | 视频流直播参数所需要指定的url type。该type类型可以表明是GB28181、RTMP、RTSP、声网等直播协议； |
| `url`                      | 在URL type确定的基础上，url用来指明该url_type基础下的具体的url参数。对于不同url_type，url的组成规则有些差别。对于声网的URL参数，为防止token中包含特殊字符，云端采用URLEncoder编码之后下发，推流端需经过URLDecoder解析之后再使用。 |
| `fps`                      | 视频流帧率                                                   |
| `bps`                      | 视频流码率                                                   |
| `dpi`                      | 视频流分辨率，或者叫resolution。                             ||

 ## Event 

### 直播能力更新
**Topic:** thing/product/{pid}/state

**Direction:** up

**Data:** 
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|live_capacity|直播能力|struct||| 
|»available_video_number|可用于直播的视频流总数|int|{}|表明飞机或设备所拥有的所有可用于直播视频流的总数| 
|»coexist_video_number_max|可同时进行直播的最大视频流总数|int|{}|| 
  |»device_list|设备直播能力列表|array|{}||
|»»[array_item]|数组中的元素|struct|{}|{"size": "2"}|
 
**Example:** 
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"live_capacity": {
			"available_video_number": 2,
			"coexist_video_number_max": 1,
			"device_list": [
				{
					"available_video_number": 2,
					"camera_list": [
						{
							"available_video_number": 1,
							"camera_index": "42-0-0",
							"coexist_video_number_max": 1,
							"video_list": [
								{
									"video_index": "zoom-0",
									"video_type": "zoom"
								},
								{
									"video_index": "wide-0",
									"video_type": "wide"
								}
							]
						},
						{
							"available_video_number": 1,
							"camera_index": "39-0-7",
							"coexist_video_number_max": 1,
							"video_list": [
								{
									"video_index": "normal-0",
									"video_type": "normal"
								}
							]
						}
					],
					"coexist_video_number_max": 0,
					"sn": "1ZNDH1D0010054"
				}
			]
		}
	},
	"timestamp:": 1654070968655,
	"gateway": "1ZMDGBW0000135"
}
```



 



 ## Service 

### 设置一路直播视频流的详细配置信息
**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** live_set_detail

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|video_id|直播码流标识符|text||格式为 #{uav_sn}/#{camera_id}/#{video_index};飞机SN号/负载及挂载位置枚举值/负载lens编号|
|fps|直播视频帧率|int|||
|bps|直播视频码率|int|||
|dpi|直播视频分辨率|text|||

 
 
**Example:** 
```json
{
	"method": "live_set_detail",
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"video_id": "AFAFEFA34D/0-43-0/normal-1",
		"fps": 30,
		"bps": 3000000,
		"dpi": "1920x1080"
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** live_set_detail

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|fps|直播视频帧率|int|||
|bps|直播视频码率|int|||
|dpi|直播视频分辨率|text|||

 
 
**Example:** 
```json
{
	"method": "live_set_detail",
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"result": 0,
		"output": {
			"fps": 30,
			"bps": 3000000,
			"dpi": "1920x1080"
		}
	}
}
```


### 开始直播
**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** live_start_push

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
 |url_type|直播协议类型|enum|{&#34;0&#34;:&#34;声网Agora&#34;,&#34;1&#34;:&#34;RTMP&#34;,&#34;2&#34;:&#34;RTSP&#34;,&#34;3&#34;:&#34;GB28181&#34;}||
|url|直播参数|text|{}|RTMP: (rtmp://xxxxxxx)示例：rtmp://192.168.1.1:8080/live	RTSP：(uerName&#38;password&#38;port)	示例：userName=dji-cloud-api&#38;password=123456&#38;port=8080	GB28181：(serverIP&#38;serverPort&#38;serverID&#38;agentID&#38;agentPassword&#38;localPort&#38;channel)	示例： serverIP=192.168.1.1&#38;serverPort=8080&#38;serverID=34000000000000000000&#38;agentID=300000000010000000000&#38;agentPassword=0000000&#38;localPort=7060&#38;channel=340000000000000000000	声网AGORA：(channel&#38;sn&#38;token&#38;uid)	示例： channel=1ZNDH360010162_39-0-7&#38;sn=1ZNDH360010162&#38;token=006dca67721582a48768ec4d817b7b25a86IAB4cw2JgN6iX8BpTPdc3e4S1Iendz94IFJ56aSXKvzAJei27MqF2zyCIgCLIIoBt41+YAQAAQC3jX5gAgC3jX5gAwC3jX5gBAC3jX5g&#38;uid=50000	注意：声网生成的token可能带有&#39;+&#39; &#39; &#39;等特殊字符，需要做一次url encode，不然PILOT端会出现解析错误的情况|
|video_id|直播视频流的ID编号|text|{}|格式为 #{uav_sn}/#{camera_id}/#{video_index};飞机SN号/负载及挂载位置枚举值/负载lens编号|
 |video_quality|直播质量|enum|{&#34;0&#34;:&#34;自适应&#34;,&#34;1&#34;:&#34;流畅&#34;,&#34;2&#34;:&#34;标清&#34;,&#34;3&#34;:&#34;高清&#34;,&#34;4&#34;:&#34;超清&#34;}||

 
 
**Example:** 
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "live_start_push",
	"data": {
		"url_type": 0,
		"url": "channel=1ZNDH1D0010098_39-0-7&sn=1ZNDH1D0010098&token=006dca67721582a48768ec4d817b7b25a86IADk%2Fcm%2Fdv%2BHY6qT%2FAKM6y7TcUe4lXNvZpycH7vUMAlM6pFALUKF2zyCIgA82pQE8cCoYAQAAQDxwKhgAgDxwKhgAwDxwKhgBADxwKhg&uid=50000",
		"video_id": "1ZNDH1D0010098/39-0-7/normal-0",
		"video_quality": 0
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** live_start_push

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|info|直播信息|text|{}|对于在应答时需要带上参数的情况下，可以在info中添加，例如RTSP就需要返回设备端的直播url地址|

 
 
**Example:** 
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "live_start_push",
	"data": {
		"result": 0,
		"info": "rtsp://${username}:${password}@192.168.1.100:8445/live/1"
	}
}
```


### 停止直播
**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** live_stop_push

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|video_id|直播视频流的ID编号|text|{}|格式为 #{uav_sn}/#{camera_id}/#{video_index};飞机SN号/负载及挂载位置枚举值/负载lens编号|

 
 
**Example:** 
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "live_stop_push",
	"data": {
		"video_id": "1ZNDH1D0010098/42-0-0/zoom-0"
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** live_stop_push

**Data:** null 
 
**Example:** 
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "live_stop_push",
	"data": {
		"result": 0
	}
}
```


### 设置直播清晰度
**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** live_set_quality

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|video_id|直播视频流的ID|text|{}|格式为 #{uav_sn}/#{camera_id}/#{video_index};飞机SN号/负载及挂载位置枚举值/负载lens编号|
 |video_quality|直播质量|enum|{&#34;0&#34;:&#34;自适应&#34;,&#34;1&#34;:&#34;流畅&#34;,&#34;2&#34;:&#34;标清&#34;,&#34;3&#34;:&#34;高清&#34;,&#34;4&#34;:&#34;超清&#34;}||

 
 
**Example:** 
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "live_set_quality",
	"data": {
		"video_id": "1ZNDH1D0010098/39-0-7/normal-0",
		"video_quality": 4
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** live_set_quality

**Data:** null 
 
**Example:** 
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "live_set_quality",
	"data": {
		"result": 0
	}
}
```




