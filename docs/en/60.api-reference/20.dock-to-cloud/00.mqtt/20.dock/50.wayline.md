




 # Event

## Notification of device exits the Return to Home (RTH) state
**Topic:** thing/product/*{gateway_sn}*/events

**Direction:** up

**Method:** device_exit_homing_notify

**Data:** 
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
 |action|Notification type of exiting RTH|enum|[{&#34;1&#34;:&#34;Enter exiting RTH state&#34;},{&#34;0&#34;:&#34;Exit exiting RTH state&#34;}]|Entering the `RTH exiting state` means that the aircraft exits the RTH process due to one of the reasons in the reason field of Cloud API. Exiting the `RTH exiting state` means the aircraft stop the exiting process.|
 |reason|Reason for exiting RTH|enum|{&#34;0&#34;:&#34;Add joystick throttle&#34;,&#34;1&#34;:&#34;Add joystick pitch&#34;,&#34;2&#34;:&#34;The initialization of behavior tree is failed&#34;,&#34;3&#34;:&#34;Surrounded by obstacles&#34;,&#34;4&#34;:&#34;Flight restriction is triggered&#34;,&#34;5&#34;:&#34;Obstacle is too closed&#34;,&#34;6&#34;:&#34;No GPS signal&#34;,&#34;7&#34;:&#34;The output flag of GPS and VIO location is false&#34;,&#34;8&#34;:&#34;The error of GPS and VIO fusion position is too large&#34;,&#34;9&#34;:&#34;Backtrack in a short distance&#34;,&#34;10&#34;:&#34;Trigger the RTH in a short distance&#34;}||

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "device_exit_homing_notify",
	"need_reply": 1,
	"timestamp:": 1654070968655,
	"data": {
		"action": 1,
		"sn": "Dock sn",
		"reason": "0"
	}
}
```




## Report wayline task progress
**Topic:** thing/product/*{gateway_sn}*/events

**Direction:** up

**Method:** flighttask_progress

**Data:** 
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|ext|Expand content|struct||| 
|»current_waypoint_index|Current waypoint index|int|{}|| 
|»media_count|Media file number generated by the wayline task execution|int|{}|| 
|»track_id|Wayline ID|text|{}|| 
|»flight_id|Task ID|text|{}|| 
|»break_point|Wayline breakpoint information|struct||Optional field for notifying the cloud server of the breakpoint information related to the current wayline task.|
|»»index|Breakpoint index|int|{}||
|»»state|Breakpoint state|enum|{&#34;0&#34;:&#34;On the wayline segment&#34;,&#34;1&#34;:&#34;On the waypoint&#34;}||
|»»progress|Current wayline segment progress|float|{&#34;min&#34;:&#34;0&#34;,&#34;max&#34;:&#34;1.0&#34;}||
|»»wayline_id|Wayline ID|int|{}||
|»»break_reason|Break reason|enum|{}||
|»»latitude|Breakpoint latitude|float|{&#34;min&#34;:&#34;-90&#34;,&#34;max&#34;:&#34;90&#34;,&#34;unit&#34;:&#34;°&#34;,&#34;unitName&#34;:&#34;degree&#34;}||
|»»longitude|Breakpoint longitude|float|{&#34;min&#34;:&#34;-180&#34;,&#34;max&#34;:&#34;180&#34;,&#34;unit&#34;:&#34;°&#34;,&#34;unitName&#34;:&#34;degree&#34;}||
|»»height|Breakpoint altitude relative to the Earth&#39;s ellipsoid surface|float|{&#34;unit&#34;:&#34;m&#34;,&#34;unitName&#34;:&#34;meter&#34;}||
|»»attitude_head|Breakpoint yaw angle|int|{}|Yaw angle relative to true north (meridian), with positive values from 0 to 6 o&#39;clock direction and negative values from 6 to 12 o&#39;clock direction|
 |status|Task state|enum|{&#34;partially_done&#34;:&#34;partially done&#34;,&#34;sent&#34;:&#34;sent&#34;,&#34;in_progress&#34;:&#34;in progress&#34;,&#34;ok&#34;:&#34;success&#34;,&#34;paused&#34;:&#34;paused&#34;,&#34;rejected&#34;:&#34;rejected&#34;,&#34;failed&#34;:&#34;failed&#34;,&#34;canceled&#34;:&#34;canceled or stopped&#34;,&#34;timeout&#34;:&#34;timeout&#34;}||
|progress|Progress|struct||| 
|»current_step|Execution step|enum|{&#34;0-4&#34;:&#34;MissionCenter starting, checking and resuming&#34;,&#34;5-18&#34;:&#34;Waiting state&#34;,&#34;19, 20&#34;:&#34;Task executing&#34;,&#34;21-29&#34;:&#34;Returning to home&#34;,&#34;30-39&#34;:&#34;Pulling logs&#34;,&#34;Others&#34;:&#34;Interaction completed&#34;}|| 
|»percent|Progress value|int|{&#34;min&#34;:&#34;0&#34;,&#34;max&#34;:&#34;100&#34;,&#34;step&#34;:&#34;1&#34;}|| 

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"output": {
			"ext": {
				"current_waypoint_index": 3,
				"media_count": 6,
				"track_id": "track_id",
				"flight_id": "flight_id",
				"break_point": {
					"index": 1,
					"state": 0,
					"progress": 0.34,
					"wayline_id": 0,
					"break_reason": 1,
					"latitude": 23.4,
					"longitude": 113.99,
					"height": 100.23,
					"attitude_head": 30
				}
			},
			"progress": {
				"current_step": 19,
				"percent": 100
			},
			"status": "ok"
		},
		"result": 0
	},
	"method": "flighttask_progress",
	"timestamp": 1654070968655
}
```




## Notification of task readiness
**Topic:** thing/product/*{gateway_sn}*/events

**Direction:** up

**Method:** flighttask_ready

**Data:** 
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
  |flight_ids|Task ID|array|{"size": }|The task ID set that currently satisfies the task readiness conditions|
|»[array_item]|Elements in array|text||| 

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"flight_ids": [
			"aaaaaaa",
			"bbbbbbb"
		]
	},
	"method": "flighttask_ready",
	"timestamp": 1654070968655
}
```







 # Service

## Create wayline task (Deprecated)



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_create

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
|flight_id|Task ID|text|{}||
|type|Task type|text|{}||
|file|Wayline file object|struct||| 
|»url|File URL|text|{}|| 
|»sign|MD5 signature|text|{}|| 

 

**Example:**
```json
{
	"method": "flighttask_create",
	"timestamp:": 1654070968655,
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"flight_id": "xxxxxxx",
		"type": "wayline",
		"file": {
			"url": "https://xxx.com/xxxx",
			"sign": "xxxx"
		}
	}
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_create

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"method": "flighttask_create",
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp:": 1654070968655,
	"data": {
		"result": 0
	}
}
```


## Issue wayline task

If user&#39;s cloud service can not connect to the Internet (that is, the WAN), it is necessary to implement the [update configuration](https://developer.dji.com/doc/cloud-api-tutorial/en/api-reference/dock-to-cloud/mqtt/dock/config.html) function to send the URL of the NTP service which can be accessed by the cloud service to synchronize the clock. Otherwise, the wayline task can not work properly.

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_prepare

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
|flight_id|Task ID|text|{}||
|execute_time|Time to execute|int|{&#34;length&#34;:13}|Millisecond timestamp of task execution time. Optional field. When the `task_type` is 0 or 1, it is required. When the `task_type` is 2, it is not required.|
 |task_type|Task type|enum|{&#34;0&#34;:&#34;Immediate task&#34;,&#34;1&#34;:&#34;Timed task&#34;,&#34;2&#34;:&#34;Conditional task&#34;}|The execution time of immediate task and timed task are defined by `execute_time`. The conditional task supports the task readiness condition defined by `ready_conditions`. The task can be executed if conditions are satisfied within a specified period. Immediate task has the highest priority. Timed task and conditional task have the same priority.|
 |wayline_type|Wayline type|enum|{&#34;0&#34;:&#34;Normal waypoint wayline&#34;}||
|file|Wayline file object|struct||| 
|»url|File URL|text|{}|| 
|»fingerprint|File signature|text|{}|File content MD5 signature| 
|ready_conditions|Task readiness condition|struct||Optional field. For conditional task (which means the `task_type` is 2), this field is required. For other types of tasks, this field is ignored. After the conditional task is issued, device will check whether the `ready_conditions` are satisfied or not at a fixed frequency. If conditions are satisfied, `flighttask_ready` event will be sent. When the device side receives the `flighttask_execute` command,   conditions of the `ready_conditions` of task will be checked whether they are all satisfied.| 
|»battery_capacity|Battery capacity|int|{}|The aircraft battery percentage threshold of the executable task. The aircraft battery must be greater than the `battery_capacity` when the task starts.| 
|»begin_time|Start time of the task executable period|int|{&#34;length&#34;:13}|Start millisecond timestamp of the task executable period. The task execution time should be later than the `begin_time`| 
|»end_time|End time of the task executable period|int|{&#34;length&#34;:13}|End millisecond timestamp of the task executable period. The task execution time should be earlier than the `end_time`.| 
|executable_conditions|Task executable condition|struct||Optional field. Pre-check conditions added for task execution on the device side. If any condition is not satisfied, execution will fail.| 
|»storage_capacity|Storage capacity|int|{}|The minimum storage capacity of DJI dock or aircraft that can execute a task. Unit: MB. If the storage capacity doesn&#39;t satisfy the `storage_capacity`, task execution will fail.| 
|break_point|Wayline breakpoint information|struct||Optional field for resuming interrupted wayline task. If specified, the wayline task will start executing from the breakpoint position indicated by the field.| 
|»index|Breakpoint index|int|{}|| 
|»state|Breakpoint state|enum|{&#34;0&#34;:&#34;On the wayline segment&#34;,&#34;1&#34;:&#34;On the waypoint&#34;}|| 
|»progress|Current wayline segment process|float|{&#34;min&#34;:&#34;0&#34;,&#34;max&#34;:&#34;1.0&#34;}|| 
|»wayline_id|Wayline ID|int|{}|| 
|rth_altitude|Height for RTH|int|{&#34;unit&#34;:&#34;meter&#34;,&#34;min&#34;:20,&#34;max&#34;:1500}||
 |out_of_control_action|Remote controller out of control action|enum|{&#34;0&#34;:&#34;Return to Home (RTH)&#34;,&#34;1&#34;:&#34;Hovering&#34;,&#34;2&#34;:&#34;Landing&#34;}|Out of control action: the current fixed transmitted value is 0, meaning Return-to-Home (RTH). Note that this enumeration value definition is inconsistent with the flight control and dock definitions, and a conversion exists at the dock end.|
 |exit_wayline_when_rc_lost|wayline out of control action|enum|{&#34;0&#34;:&#34;Continue executing the wayline task&#34;,&#34;1&#34;:&#34;Exit the wayline task and execute the remote controller out of control action&#34;}|consistent with the KMZ file|

 

**Example:**
```json
{
	"method": "flighttask_prepare",
	"timestamp": 1234567890123,
	"tid": "123",
	"bid": "456",
	"data": {
		"execute_time": 1234567890123,
		"flight_id": "xxxxxxx",
		"task_type": 2,
		"wayline_type": 1,
		"file": {
			"url": "https://xxx.com/xxxx",
			"fingerprint": "xxxx"
		},
		"ready_conditions": {
			"battery_capacity": 90,
			"begin_time": 1234567890123,
			"end_time": 1234567890123
		},
		"executable_conditions": {
			"storage_capacity": 1000
		},
		"break_point": {
			"index": 1,
			"state": 0,
			"progress": 0.34,
			"wayline_id": 0
		},
		"rth_altitude": 100,
		"out_of_control_action": 0
	}
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_prepare

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"method": "flighttask_prepare",
	"tid": "123",
	"bid": "456",
	"timestamp": 1234567890123,
	"data": {
		"result": 0
	}
}
```


## Execute wayline task



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_execute

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
|flight_id|Task ID|text|{}||

 

**Example:**
```json
{
	"method": "flighttask_execute",
	"timestamp": 1234567890123,
	"tid": "123",
	"bid": "456",
	"data": {
		"flight_id": "xxxxxxx"
	}
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_execute

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int|{}|Non-0 means error|

 

**Example:**
```json
{
	"method": "flighttask_execute",
	"tid": "123",
	"bid": "456",
	"timestamp": 1234567890123,
	"data": {
		"result": 0
	}
}
```


## Cancel wayline task



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_undo

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
  |flight_ids|Task ID|array|{"size": }||
|»[array_item]|Elements in array|text||| 

 

**Example:**
```json
{
	"method": "flighttask_undo",
	"timestamp": 1234567890123,
	"tid": "123",
	"bid": "456",
	"data": {
		"flight_ids": [
			"aaaaaaa",
			"bbbbbbb"
		]
	}
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_undo

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"method": "flighttask_undo",
	"tid": "123",
	"bid": "456",
	"timestamp": 1234567890123,
	"data": {
		"result": 0
	}
}
```


## Pause wayline task



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_pause

**Data:** null 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_pause",
	"data": {}
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_pause

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|return code|int||Non-0 means error|

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"need_reply": 1,
	"method": "flighttask_pause",
	"data": {
		"result": 0
	}
}
```


## Resume wayline task



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** flighttask_recovery

**Data:** null 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "flighttask_recovery",
	"data": {}
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** flighttask_recovery

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"need_reply": 1,
	"method": "flighttask_recovery",
	"data": {
		"result": 0
	}
}
```


## Return to Home (RTH)



**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** return_home

**Data:** null 



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** return_home

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int|{}|Non-0 means error|
|output|output|struct||| 
|»status|mission state|enum|{&#34;sent&#34;:&#34;sent&#34;,&#34;in_progress&#34;:&#34;in progress&#34;,&#34;ok&#34;:&#34;succeeded&#34;,&#34;paused&#34;:&#34;paused&#34;,&#34;rejected&#34;:&#34;rejected&#34;,&#34;failed&#34;:&#34;failed&#34;,&#34;canceled&#34;:&#34;canceled or terminated&#34;,&#34;timeout&#34;:&#34;timeout&#34;}|| 

 


## Cancel return to home

After returning to home, the aircraft will exit the wayline mode. At this point, if the return-to-home command is canceled, the aircraft will hover.

**Topic:** thing/product/*{gateway_sn}*/services

**Direction:** down

**Method:** return_home_cancel

**Data:** null 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"method": "return_home_cancel",
	"data": {}
}
```



**Topic:** thing/product/*{gateway_sn}*/services_reply

**Direction:** up

**Method:** return_home_cancel

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp": 1654070968655,
	"need_reply": 1,
	"method": "return_home_cancel",
	"data": {
		"result": 0
	}
}
```



 # Requests

## Get the wayline task resource



**Topic:** thing/product/*{gateway_sn}*/requests

**Direction:** up

**Method:** flighttask_resource_get

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|flight_id|Task ID|text|{}||

 

**Example:**
```json
{
	"method": "flighttask_resource_get",
	"timestamp": 1234567890123,
	"tid": "123",
	"bid": "456",
	"data": {
		"flight_id": "xxxxxxx"
	}
}
```



**Topic:** thing/product/*{gateway_sn}*/requests_reply

**Direction:** down

**Method:** flighttask_resource_get

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|
|output|Output|struct||| 
|»file|Wayline file object|struct|||
|»»url|File URL|text|{}||
|»»fingerprint|File signature|text|{}|File MD5 signature|

 

**Example:**
```json
{
	"method": "flighttask_resource_get",
	"tid": "123",
	"bid": "456",
	"timestamp": 1234567890123,
	"data": {
		"result": 0,
		"output": {
			"file": {
				"fingerprint": "signxxxx",
				"url": "https://xx.oss-cn-hangzhou.aliyuncs.com/xx.kmz?Expires=xx&OSSAccessKeyId=xxx&Signature=xxx"
			}
		}
	}
}
```



