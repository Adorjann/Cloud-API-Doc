




 # Event

## Notification of device exit state
**Topic:** thing/product/{pid}/events

**Direction:** up

**Method:** device_exit_homing_notify

**Data:** 
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
 |action|Notification type of exiting RTH|enum|[{&#34;1&#34;:&#34;Enter exiting RTH&#34;},{&#34;0&#34;:&#34;Exit exiting RTH&#34;}]||
 |reason|Reason of exiting RTH|enum|{&#34;0&#34;:&#34;Add joystick throttle&#34;,&#34;1&#34;:&#34;Add joystick pitch&#34;,&#34;2&#34;:&#34;The init of behavior tree fail&#34;,&#34;3&#34;:&#34;Surrounding by obstacles&#34;,&#34;4&#34;:&#34;Max height of NFZ stuck&#34;,&#34;5&#34;:&#34;Obstacle is too near in short distance&#34;,&#34;6&#34;:&#34;No gps signal&#34;,&#34;7&#34;:&#34;The output flag of gps and vio location is false&#34;,&#34;8&#34;:&#34;The error of gps and vio fusion position is too large&#34;,&#34;9&#34;:&#34;Backtrack in short distance&#34;,&#34;10&#34;:&#34;When trigger gohome in short distance&#34;}||

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"method": "device_exit_homing_notify",
	"need_reply": true,
	"timestamp:": 1654070968655,
	"data": {
		"action": 1,
		"sn": "Dock sn",
		"reason": "0"
	}
}
```




## Report wayline task progress
**Topic:** thing/product/{pid}/events

**Direction:** up

**Method:** flighttask_progress

**Data:** 
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|ext|Expand content|struct||| 
|»current_waypoint_index|Current waypoint number|int|{}|| 
|»media_count|The number of media files generated by the execution of this wayline task|int|{}|| 
|»track_id|Wayline id|text|{}|| 
 |status|Mission status|enum|{&#34;partially_done&#34;:&#34;partially done&#34;,&#34;sent&#34;:&#34;sent&#34;,&#34;in_progress&#34;:&#34;in progress&#34;,&#34;ok&#34;:&#34;success&#34;,&#34;paused&#34;:&#34;paused&#34;,&#34;rejected&#34;:&#34;rejected&#34;,&#34;failed&#34;:&#34;failed&#34;,&#34;canceled&#34;:&#34;canceled or stopped&#34;,&#34;timeout&#34;:&#34;timeout&#34;}||
|progress|Progress|struct||| 
|»current_step|steps|enum|{&#34;1&#34;:&#34;Download kmz wayline task&#34;,&#34;2&#34;:&#34;KMZ uploading&#34;,&#34;3&#34;:&#34;Route execution&#34;}|| 
|»percent|Progress value|int|{&#34;min&#34;:&#34;0&#34;,&#34;max&#34;:&#34;100&#34;,&#34;step&#34;:&#34;1&#34;}|| 

 

**Example:**
```json
{
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"output": {
			"ext": {
				"current_waypoint_index": 3,
				"media_count": 6,
				"track_id": "track_id"
			},
			"progress": {
				"current_step": 19,
				"percent": 100
			},
			"status": "ok"
		},
		"result": 0
	},
	"method": "flighttask_progress",
	"timestamp": 1654070968655
}
```



**Topic:** thing/product/{pid}/events_reply

**Direction:** down

**Method:** flighttask_progress

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return code|int||Non-0 means error|

**Example:**
```json
{
	"method": "flighttask_progress",
	"tid": "6a7bfe89-c386-4043-b600-b518e10096cc",
	"bid": "42a19f36-5117-4520-bd13-fd61d818d52e",
	"timestamp": "1234567890123",
	"data": {
		"result": 0
	}
}
```





 # Service

## Create wayline task (Deprecated)



**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** flighttask_create

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
|flight_id|Task ID|text|{}||
|type|task type|text|{}||
|file|Wayline file object|struct||| 
|»url|file URL|text|{}|| 
|»sign|MD5 sign|text|{}|| 

 

**Example:**
```json
{
	"method": "flighttask_create",
	"timestamp:": 1654070968655,
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"data": {
		"flight_id": "xxxxxxx",
		"type": "wayline",
		"file": {
			"url": "https://xxx.com/xxxx",
			"sign": "xxxx"
		}
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** flighttask_create

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"method": "flighttask_create",
	"bid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"tid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx",
	"timestamp:": 1654070968655,
	"data": {
		"result": 0
	}
}
```


## Issue wayline task



**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** flighttask_prepare

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
|flight_id|Task ID|text|{}||
|execute_time|Time to execute|int|{&#34;length&#34;:13}|Millisecond timestamp of task start time|
 |task_type|Task type|enum|{&#34;0&#34;:&#34;immediate task&#34;,&#34;1&#34;:&#34;timing task&#34;}||
 |wayline_type|Wayline type|enum|{&#34;0&#34;:&#34;Normal waypoint wayline&#34;}||
|file|Wayline file object|struct||| 
|»url|File URL|text|{}|| 
|»fingerprint|File signature|text|{}|File content MD5 signature| 

 

**Example:**
```json
{
	"method": "flighttask_prepare",
	"timestamp": "1234567890123",
	"tid": "123",
	"bid": "456",
	"data": {
		"execute_time": "1234567890123",
		"flight_id": "xxxxxxx",
		"task_type": 1,
		"wayline_type": 1,
		"file": {
			"url": "https://xxx.com/xxxx",
			"fingerprint": "xxxx"
		}
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** flighttask_prepare

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"method": "flighttask_prepare",
	"tid": "123",
	"bid": "456",
	"timestamp": "1234567890123",
	"data": {
		"result": 0
	}
}
```


## Execute wayline task



**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** flighttask_execute

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
|flight_id|Task ID|text|{}||

 

**Example:**
```json
{
	"method": "flighttask_execute",
	"timestamp": "1234567890123",
	"tid": "123",
	"bid": "456",
	"data": {
		"flight_id": "xxxxxxx"
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** flighttask_execute

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Result Code|int|{}||

 

**Example:**
```json
{
	"method": "flighttask_execute",
	"tid": "123",
	"bid": "456",
	"timestamp": "1234567890123",
	"data": {
		"result": 0
	}
}
```


## Cancel wayline task



**Topic:** thing/product/{pid}/services

**Direction:** down

**Method:** flighttask_undo

**Data:**
 |Column|Name|Type|constraint|Description| 
|---|---|---|---|---|
  |flight_id|Task ID|array|{&#34;item&#34;:{&#34;type&#34;:&#34;text&#34;}}|| 
    

 

**Example:**
```json
{
	"method": "flighttask_undo",
	"timestamp": "1234567890123",
	"tid": "123",
	"bid": "456",
	"data": {
		"flight_id": [
			"aaaaaaa",
			"bbbbbbb"
		]
	}
}
```



**Topic:** thing/product/{pid}/services_reply

**Direction:** up

**Method:** flighttask_undo

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|

 

**Example:**
```json
{
	"method": "flighttask_undo",
	"tid": "123",
	"bid": "456",
	"timestamp": "1234567890123",
	"data": {
		"result": 0
	}
}
```



 # Requests

## Get the wayline task resource



**Topic:** thing/product/{pid}/requests

**Direction:** up

**Method:** flighttask_resource_get

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|flight_id|Task ID|text|{}||

 

**Example:**
```json
{
	"method": "flighttask_resource_get",
	"timestamp": "1234567890123",
	"tid": "123",
	"bid": "456",
	"data": {
		"flight_id": "xxxxxxx"
	}
}
```



**Topic:** thing/product/{pid}/requests_reply

**Direction:** down

**Method:** flighttask_resource_get

**Data:**
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Return Code|int||Non-0 means error|
|output|Output|struct||| 
|»file|Wayline file object|struct|||
|»»url|File URL|text|{}||
|»»fingerprint|File signature|text|{}|File MD5 signature|

 

**Example:**
```json
{
	"method": "flighttask_resource_get",
	"tid": "123",
	"bid": "456",
	"timestamp": "1234567890123",
	"data": {
		"result": 0,
		"output": {
			"file": {
				"fingerprint": "signxxxx",
				"url": "https://xx.oss-cn-hangzhou.aliyuncs.com/xx.kmz?Expires=xx&OSSAccessKeyId=xxx&Signature=xxx"
			}
		}
	}
}
```


