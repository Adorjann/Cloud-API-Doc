## Thing Model Topic Overview

In order to distinguish the processing strategy of different properties, we divide the device properties into `osd` and `state`, and upload them through different topic.

- osd: The properties that are uploaded in frequency by device, which is corresponding to the peoperties of `pushmode = 0`.
- state: The properties that are evently uploaded by device or are asked to upload by server, which is corresponding to the peoperties of `pushmode = 1` and `pushmode = 2`. The server will store the `state` properties and provide searching by HTTP API.


| Topic Name | Sender -> Subscriber | Message | Illustration |
|--|--|--|--|
|  thing/product/#{pid}/osd | Device > Cloud Server | [osd message struct](#osd-message-struct) |The properties that are uploaded in frequency by device(properties）,<br/>For the specific content range, please refer to the content of the thing model.|
|  thing/product/#{pid}/state | Device > Cloud Server | [state message struct](#state-message-struct) |The properties that are uploaded in need by device（properties）,<br/>For the specific content range, please refer to the content of the thing model. |
|  thing/product/#{pid}/state_reply | Cloud Server > Device | [state_reply message struct](#state_reply-message-struct) |The reply and processing result of state information by cloud server. |
| thing/product/#{pid}/services |  Cloud Server > Device | [services message struct](#services-message-struct) | The services sent by device to cloud server.（For specific service identifier, please refer to the content of the thing model. ）。|
|  thing/product/#{pid}/services_reply | Device > Cloud Server | [services_reply message struct](#services_reply-message-struct) | The reply and processing result of service by device.|
|  thing/product/#{pid}/events |  Device > Cloud Server | [events message struct](#events-message-struct) |  The events that need to be followed and processed, which is sent by device to cloud server.<br/>For example, the SD is full, the information of fly zone is unrestricted, and so on.（For the events range,please refer to the content of the thing model.）|
| thing/product/#{pid}/events_reply |  Cloud Server > Device |[events_reply message struct](#events_reply-message-struct)  |The reply and processing result of device event by cloud server.|
|  thing/product/#{pid}/requests |  Device > Cloud Server | [requests message struct](#requests-message-struct) |  Device send requests to cloud server for obtaining some information. For example, the temporary credentials.|
| thing/product/#{pid}/requests_reply |  Cloud Server > Device |[requests_reply message struct](#requests_reply-message-struct)   |The reply to device requests by cloud server.|
|  sys/product/#{pid}/status |  Device > Cloud Server | [status message struct](#requests-message-struct) |  Device online, device offline, topology update.|
| sys/product/#{pid}/status_reply |  Cloud Server > Device |[status_reply message struct](#requests_reply-message-struct)   | Reply by platform.|



## Message

### Common Field Explanation
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
 |tid|Transaction uuid|text|-|Transaction UUID: Characterize a simple message communication. For example, add, delete, modify, check, and gimbal control. It can be: <br/> 1. Data report request + data report response<br />2. Handshake authentication request + Response+ack<br /> 3.One-way notification of alarm events, etc., to solve the problem of multi-concurrency transactions and message matching.|
|bid|Business uuid|text|-|Business UUID: Some functions are not completed in one communication and include all interactions over a period of time. <br/>The business is usually composed of multiple atomic transactions and has a long duration; <br/>For example, on-demand/download/playback; solves the problem of multiple concurrent and repeated requests for business, and facilitates the state machine management of all modules|
|timestamp|millisecond timestamp|int|-|the time the message was sent|
|gateway|Serial number of the gateway device|text|-|The serial number of the gateway device that sent the message|
|data|Message content|object|-|Message content|

### <a id="osd-message-struct"> osd message struct </a>
*topic*:  thing/product/#{pid}/osd

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "data": {
        "43-0-0":{ //Loaded object model properties
            "gimbal_pitch":0,
            "gimbal_roll":0,
            "gimbal_yaw":-103.7,
            "measure_target_altitude":100,
            "measure_target_distance":1256.800049,
            "measure_target_error_state":1,
            "measure_target_latitude":21.99849,
            "measure_target_longitude":112.987933,
            "payload_index":"43-0-0",
            "version":1
        },
        "attitude_head":0,
        "attitude_pitch":-0.5,
        "attitude_roll":-0.1,
        "battery":{
            "batteries":[
                {
                    "capacity_percent":90,
                    "firmware_version":"01.02.05.31",
                    "index":0,
                    "loop_times":131,
                    "sn":"xxxx",
                    "sub_type":0,
                    "temperature":23.1,
                    "type":0,
                    "voltage":49032
                }
            ],
            "capacity_percent":45,
            "landing_power":5,
            "remain_flight_time":0,
            "return_home_power":10
        },
        "elevation":0,
        "firmware_version":"04.00.0014",
        "gear":1,
        "height":100.020332,
        "home_distance":0,
        "horizontal_speed":0,
        "latitude":22,
        "longitude":113,
        "mode_code":0,
        "position_state":{
            "gps_number":15,
            "is_fixed":0,
            "quality":5,
            "rtk_number":0
        },
        "total_flight_distance":0,
        "total_flight_time":0,
        "vertical_speed":0,
        "wind_direction":0,
        "wind_speed":0
    }
}  
```
### <a id="state-message-struct"> state message struct </a>

*topic*:  thing/product/#{pid}/state

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "data":{},
}
```

### <a id="state_reply-message-struct"> state_reply message struct </a>

*topic*:  thing/product/#{pid}/state_reply
#### Explanation of required fields in data
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Result code|int|-|Non-0 means error|

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "method": "some_method",
    "data": {
        "result": 0 
    }
}
```
### <a id="services-message-struct"> services message struct </a>
*topic*: thing/product/#{pid}/services

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "method": "some_method",
    "data": {}
}
```
### <a id="services_reply-message-struct"> services_reply message struct </a>

#### Explanation of required fields in data
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|The result code of the device's response|int|-|Non-0 means error|
|output|Device message content|struct|-|The content of the message that the device responds to the server command|

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "method": "some_method",
    "data": {
        "result": 0, 
    	"output": {}
    }  
}
``` 
### <a id="events-message-struct"> events message struct </a>

*topic*: thing/product/#{pid}/events
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|need_reply|Does the server need a reply|int|-|After the server receives the device's events event report message, it follows need_reply to determine whether it has received a reply; 0 means no need, 1 means need.|


```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "need_reply": 0,
    "gateway":"sn",
    "method": "some_method",
    "data": {}
}
```
### <a id="events_reply-message-struct"> events_reply message struct </a>

*topic*: thing/product/#{pid}/events_reply

#### Explanation of required fields in data
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Result code of server response|int|-|Non-0 means error|

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "method": "some_method",
    "data": {
        "result": 0
    }
}
```
### <a id="requests-message-struct"> requests message struct </a>

*topic*: thing/product/#{pid}/requests

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "method": "some_method",
    "data": {}
}
```
### <a id="requests_reply-message-struct"> requests_reply message struct </a>

*topic*: thing/product/#{pid}/requests_reply

#### Explanation of required fields in data
|Column|Name|Type|constraint|Description|
|---|---|---|---|---|
|result|Result code of server response|int|-|Non-0 means error|
|output|Service message content|struct|-|The server responds to the message content of the device|

```json
{
    "tid":"6a7bfe89-c386-4043-b600-b518e10096cc",
    "bid":"42a19f36-5117-4520-bd13-fd61d818d52e",
    "timestamp": 1598411295123,
    "gateway":"sn",
    "method": "some_method",
    "data": {
        "result": 0,
        "output":{}
    }
}
```